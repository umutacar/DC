\begin{datastructure}[Implementing the BST ADT with \cd{split} and \cd{join}]
\label{ds:bst::parametric}
\begin{lstlisting}
type $\tttt$ = Leaf | Node of ($\tttt$ ** $\kkk$ ** $\tttt$)
split $t$ $k$ = ... (* as given *)
join $t_1$ $t_2$ = ... (* as given *)

joinM $t_1$ $k$ $t_2$ = join $t_1$ (join (singleton $k$) $t_2$)
empty = Leaf
singleton $(k)$ = Node(Leaf,$k$,Leaf)  
find $t$ $k$ = let (_,$v$,_) = split $t$ $k$  in $v$ end 
delete $t$ $k$ = let $(l,\_,r)$ = split $t$ $k$ in join $l$ $r$ end
insert $t$ $k$ = let $(l,\_,r)$ = split $t$ $k$ in joinM $l$ $k$ $r$ end 

intersect $t_1$ $t_2$ =
  case ($t_1$,$t_2$) 
  | (Leaf,_) => Leaf
  | (_,Leaf) => Leaf
  | (Node $(l_1,k_1,r_1)$,_) => 
    let $(l_2,b,r_2)$ = split $t_2$ $k_1$
       $(l,r)$ = (intersect $l_1$ $l_2$) || (intersect $r_1$ $r_2$)
    in if $b$ then joinM $l$ $k_1$ $r$ else join $l$ $r$ end

difference $t_1$ $t_2$ =
  case ($t_1$, $t_2$)
  | (Leaf,_) => Leaf
  | (_,Leaf) => $t_1$
  | (Node $(l_1,k_1,r_1)$,_) => 
    let $(l_2,b,r_2)$ = split $t_2$ $k_1$
        $(l,r)$ = (difference $l_1$ $l_2$) || (difference $r_1$ $r_2$)
    in if $b$ then join $l$ $r$ else joinM $L$ $k_1$ $r$ end

union $t_1$ $t_2$ =
  case ($t_1$,$t_2$)
  | (Leaf,_) => $t_2$
  | (_,Leaf) => $t_1$
  | (Node $(l_1,k_1,r_1)$,_) =>   
    let $(l_2,\_,r_2)$ = split $t_2$ $k_1$
        $(l,r)$ = (union $l_1$ $l_2$) || (union $r_1$ $r_2$)
    in joinM $l$ $k_1$ $r$ end    
\end{lstlisting}
\end{datastructure}
